2025-07-30 06:33:01,564 - config - INFO - MindBot v0.1 (2024-01-20) - Configuration loaded successfully
2025-07-30 06:33:01,565 - config - DEBUG - DingTalk Client ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:01,565 - config - DEBUG - DingTalk Robot Code: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:01,565 - config - DEBUG - DingTalk Robot Name: MindBot_poc
2025-07-30 06:33:01,565 - config - DEBUG - Dify API Key: ***
2025-07-30 06:33:01,566 - config - DEBUG - Dify Base URL: http://dify.mindspringedu.com/v1
2025-07-30 06:33:01,566 - config - DEBUG - Qwen API Key: ***
2025-07-30 06:33:01,566 - config - DEBUG - Qwen Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-07-30 06:33:01,566 - config - DEBUG - Qwen Model: qwen-turbo-latest
2025-07-30 06:33:01,566 - config - DEBUG - OpenAI API Key: NOT SET
2025-07-30 06:33:16,015 - config - INFO - MindBot v0.1 (2024-01-20) - Configuration loaded successfully
2025-07-30 06:33:16,016 - config - DEBUG - DingTalk Client ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:16,016 - config - DEBUG - DingTalk Robot Code: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:16,016 - config - DEBUG - DingTalk Robot Name: MindBot_poc
2025-07-30 06:33:16,017 - config - DEBUG - Dify API Key: ***
2025-07-30 06:33:16,017 - config - DEBUG - Dify Base URL: http://dify.mindspringedu.com/v1
2025-07-30 06:33:16,017 - config - DEBUG - Qwen API Key: ***
2025-07-30 06:33:16,017 - config - DEBUG - Qwen Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-07-30 06:33:16,018 - config - DEBUG - Qwen Model: qwen-turbo-latest
2025-07-30 06:33:16,018 - config - DEBUG - OpenAI API Key: NOT SET
2025-07-30 06:33:30,677 - config - INFO - MindBot v0.1 (2024-01-20) - Configuration loaded successfully
2025-07-30 06:33:30,678 - config - DEBUG - DingTalk Client ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:30,679 - config - DEBUG - DingTalk Robot Code: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:30,679 - config - DEBUG - DingTalk Robot Name: MindBot_poc
2025-07-30 06:33:30,679 - config - DEBUG - Dify API Key: ***
2025-07-30 06:33:30,680 - config - DEBUG - Dify Base URL: http://dify.mindspringedu.com/v1
2025-07-30 06:33:30,680 - config - DEBUG - Qwen API Key: ***
2025-07-30 06:33:30,680 - config - DEBUG - Qwen Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-07-30 06:33:30,681 - config - DEBUG - Qwen Model: qwen-turbo-latest
2025-07-30 06:33:30,681 - config - DEBUG - OpenAI API Key: NOT SET
2025-07-30 06:33:31,552 - asyncio - DEBUG - Using proactor: IocpProactor
2025-07-30 06:33:31,554 - debug - INFO - Starting MindBot Stream Application...
2025-07-30 06:33:31,554 - banner - INFO - MindBot banner displayed
2025-07-30 06:33:31,555 - debug - INFO - Initializing MindBot Stream Application
2025-07-30 06:33:31,555 - debug - INFO - Version: 0.1 (2024-01-20)
2025-07-30 06:33:31,555 - debug - INFO - Instance: 85989a40
2025-07-30 06:33:31,555 - debug - INFO - Initializing AI Agent...
2025-07-30 06:33:31,555 - agent - INFO - MindBotAgent v0.1 initialized successfully
2025-07-30 06:33:31,556 - debug - INFO - Agent initialized successfully
2025-07-30 06:33:31,556 - debug - INFO - Initializing DingTalk Stream Client...
2025-07-30 06:33:31,556 - dingtalk_client - ERROR - Error initializing DingTalk client: name 'Credential' is not defined
2025-07-30 06:33:31,557 - dingtalk_client - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 365, in __init__
    credential = Credential(
                 ^^^^^^^^^^
NameError: name 'Credential' is not defined

2025-07-30 06:33:31,558 - debug - ERROR - Error during initialization: name 'Credential' is not defined
2025-07-30 06:33:31,560 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 365, in __init__
    credential = Credential(
                 ^^^^^^^^^^
NameError: name 'Credential' is not defined

2025-07-30 06:33:31,560 - debug - ERROR - Error in application: name 'Credential' is not defined
2025-07-30 06:33:31,562 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 101, in start
    await self.initialize()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 365, in __init__
    credential = Credential(
                 ^^^^^^^^^^
NameError: name 'Credential' is not defined

2025-07-30 06:33:31,563 - debug - ERROR - Application error: name 'Credential' is not defined
2025-07-30 06:33:31,565 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 149, in main
    await app.start()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 101, in start
    await self.initialize()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 365, in __init__
    credential = Credential(
                 ^^^^^^^^^^
NameError: name 'Credential' is not defined

2025-07-30 06:33:31,566 - debug - INFO - Stopping MindBot Stream Application...
2025-07-30 06:33:31,566 - debug - INFO - Application stopped successfully
2025-07-30 06:33:48,861 - config - INFO - MindBot v0.1 (2024-01-20) - Configuration loaded successfully
2025-07-30 06:33:48,862 - config - DEBUG - DingTalk Client ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:48,863 - config - DEBUG - DingTalk Robot Code: dingr6bg0cj9ylmlpuqz
2025-07-30 06:33:48,864 - config - DEBUG - DingTalk Robot Name: MindBot_poc
2025-07-30 06:33:48,864 - config - DEBUG - Dify API Key: ***
2025-07-30 06:33:48,865 - config - DEBUG - Dify Base URL: http://dify.mindspringedu.com/v1
2025-07-30 06:33:48,865 - config - DEBUG - Qwen API Key: ***
2025-07-30 06:33:48,865 - config - DEBUG - Qwen Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-07-30 06:33:48,866 - config - DEBUG - Qwen Model: qwen-turbo-latest
2025-07-30 06:33:48,866 - config - DEBUG - OpenAI API Key: NOT SET
2025-07-30 06:33:49,774 - asyncio - DEBUG - Using proactor: IocpProactor
2025-07-30 06:33:49,778 - debug - INFO - Starting MindBot Stream Application...
2025-07-30 06:33:49,780 - banner - INFO - MindBot banner displayed
2025-07-30 06:33:49,781 - debug - INFO - Initializing MindBot Stream Application
2025-07-30 06:33:49,781 - debug - INFO - Version: 0.1 (2024-01-20)
2025-07-30 06:33:49,782 - debug - INFO - Instance: 989080d0
2025-07-30 06:33:49,782 - debug - INFO - Initializing AI Agent...
2025-07-30 06:33:49,783 - agent - INFO - MindBotAgent v0.1 initialized successfully
2025-07-30 06:33:49,784 - debug - INFO - Agent initialized successfully
2025-07-30 06:33:49,784 - debug - INFO - Initializing DingTalk Stream Client...
2025-07-30 06:33:49,785 - DingTalkStream - ERROR - Error configuring SSL context: name 'ssl' is not defined
2025-07-30 06:33:49,786 - dingtalk_client - ERROR - Error initializing DingTalk client: name 'DINGTALK_ROBOT_CODE' is not defined
2025-07-30 06:33:49,789 - dingtalk_client - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 379, in __init__
    self.message_handler = MessageHandler(agent_handler, self.debug_logger)
                           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 125, in __init__
    self.robot_code = DINGTALK_ROBOT_CODE
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'DINGTALK_ROBOT_CODE' is not defined

2025-07-30 06:33:49,790 - debug - ERROR - Error during initialization: name 'DINGTALK_ROBOT_CODE' is not defined
2025-07-30 06:33:49,793 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 379, in __init__
    self.message_handler = MessageHandler(agent_handler, self.debug_logger)
                           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 125, in __init__
    self.robot_code = DINGTALK_ROBOT_CODE
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'DINGTALK_ROBOT_CODE' is not defined

2025-07-30 06:33:49,795 - debug - ERROR - Error in application: name 'DINGTALK_ROBOT_CODE' is not defined
2025-07-30 06:33:49,797 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 101, in start
    await self.initialize()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 379, in __init__
    self.message_handler = MessageHandler(agent_handler, self.debug_logger)
                           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 125, in __init__
    self.robot_code = DINGTALK_ROBOT_CODE
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'DINGTALK_ROBOT_CODE' is not defined

2025-07-30 06:33:49,799 - debug - ERROR - Application error: name 'DINGTALK_ROBOT_CODE' is not defined
2025-07-30 06:33:49,802 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 149, in main
    await app.start()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 101, in start
    await self.initialize()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 53, in initialize
    self.dingtalk_client = MindBotDingTalkClient(
                           ~~~~~~~~~~~~~~~~~~~~~^
        agent_handler=self.handle_message
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 379, in __init__
    self.message_handler = MessageHandler(agent_handler, self.debug_logger)
                           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 125, in __init__
    self.robot_code = DINGTALK_ROBOT_CODE
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'DINGTALK_ROBOT_CODE' is not defined

2025-07-30 06:33:49,803 - debug - INFO - Stopping MindBot Stream Application...
2025-07-30 06:33:49,804 - debug - INFO - Application stopped successfully
2025-07-30 06:37:13,219 - asyncio - DEBUG - Using proactor: IocpProactor
2025-07-30 06:37:13,221 - debug - INFO - Starting MindBot Stream Application...
2025-07-30 06:37:13,222 - banner - INFO - MindBot banner displayed
2025-07-30 06:37:13,222 - debug - INFO - Initializing MindBot Stream Application
2025-07-30 06:37:13,222 - debug - INFO - Version: 0.1 (2024-01-20)
2025-07-30 06:37:13,223 - debug - INFO - Instance: e3384f0e
2025-07-30 06:37:13,223 - debug - INFO - Initializing AI Agent...
2025-07-30 06:37:13,223 - agent - INFO - MindBotAgent v0.1 initialized successfully
2025-07-30 06:37:13,223 - debug - INFO - Agent initialized successfully
2025-07-30 06:37:13,224 - debug - INFO - Initializing DingTalk Stream Client...
2025-07-30 06:37:13,963 - DingTalkStream - INFO - SSL context configured successfully
2025-07-30 06:37:13,964 - DingTalkStream - INFO - DingTalk Stream Client v0.1 initialized
2025-07-30 06:37:13,965 - DingTalkStream - INFO - === ROBOT CONFIGURATION VALIDATION ===
2025-07-30 06:37:13,965 - DingTalkStream - INFO - Robot Code: dingr6bg0cj9ylmlpuqz
2025-07-30 06:37:13,965 - DingTalkStream - INFO - Robot Name: MindBot_poc
2025-07-30 06:37:13,965 - DingTalkStream - INFO - Client ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:37:13,966 - DingTalkStream - INFO - Client Secret: ***
2025-07-30 06:37:13,966 - DingTalkStream - INFO - ✅ Robot Code matches Client ID
2025-07-30 06:37:13,966 - DingTalkStream - INFO - PASS DINGTALK_CLIENT_ID: dingr6bg0cj9ylmlpuqz
2025-07-30 06:37:13,966 - DingTalkStream - INFO - PASS DINGTALK_CLIENT_SECRET: h2uRQXw2osb5-VhAzCd_fhwXWwTKiitF8pBIb0JuXENwkxnjksYoHtMDqnGwVQmD
2025-07-30 06:37:13,967 - DingTalkStream - INFO - PASS DINGTALK_ROBOT_CODE: dingr6bg0cj9ylmlpuqz
2025-07-30 06:37:13,967 - DingTalkStream - INFO - === END ROBOT CONFIGURATION VALIDATION ===
2025-07-30 06:37:13,968 - debug - INFO - DingTalk client initialized successfully
2025-07-30 06:37:13,968 - debug - INFO - Running system diagnostics...
2025-07-30 06:37:13,968 - debug - INFO - Starting comprehensive diagnostics...
2025-07-30 06:37:13,968 - ConnectionTester - INFO - Validating configuration...
2025-07-30 06:37:13,969 - ConnectionTester - INFO - Configuration validation passed
2025-07-30 06:37:13,969 - ConnectionTester - INFO - Testing Dify API connection...
2025-07-30 06:37:18,402 - ConnectionTester - INFO - Dify API connection successful
2025-07-30 06:37:18,404 - ConnectionTester - INFO - Testing Qwen API connection...
2025-07-30 06:37:27,139 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-d369ebc7-c4cc-4952-9ecf-b9b0e6a485f6', 'json_data': {'messages': [{'content': 'Hello', 'role': 'user'}], 'model': 'qwen-turbo-latest', 'stream': False, 'temperature': 0.0}}
2025-07-30 06:37:27,142 - openai._base_client - DEBUG - Sending HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
2025-07-30 06:37:27,175 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=7078 local_address=None timeout=None socket_options=None
2025-07-30 06:37:27,180 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021ADDE34590>
2025-07-30 06:37:27,182 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'CONNECT']>
2025-07-30 06:37:27,187 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-30 06:37:27,188 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'CONNECT']>
2025-07-30 06:37:27,191 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-30 06:37:27,192 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'CONNECT']>
2025-07-30 06:37:27,194 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'Connection established', [])
2025-07-30 06:37:27,195 - httpcore.proxy - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021ADDC869F0> server_hostname='dashscope.aliyuncs.com' timeout=None
2025-07-30 06:37:28,030 - httpcore.proxy - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021ADDDB5F90>
2025-07-30 06:37:28,033 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-30 06:37:28,035 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-30 06:37:28,036 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-30 06:37:28,039 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-30 06:37:28,040 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-30 06:37:28,833 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'vary', b'Origin,Access-Control-Request-Method,Access-Control-Request-Headers, Accept-Encoding'), (b'x-request-id', b'e6e0fde2-4359-9c82-8dda-f61754f9b689'), (b'x-dashscope-call-gateway', b'true'), (b'content-type', b'application/json'), (b'req-cost-time', b'428'), (b'req-arrive-time', b'1753828648208'), (b'resp-start-time', b'1753828648637'), (b'x-envoy-upstream-service-time', b'428'), (b'set-cookie', b'acw_tc=e6e0fde2-4359-9c82-8dda-f61754f9b689bb092671a222ae572bc4d021dabf652e;path=/;HttpOnly;Max-Age=1800'), (b'content-encoding', b'gzip'), (b'date', b'Tue, 29 Jul 2025 22:37:28 GMT'), (b'server', b'istio-envoy'), (b'transfer-encoding', b'chunked')])
2025-07-30 06:37:28,837 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-30 06:37:28,839 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-30 06:37:28,842 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-30 06:37:28,844 - httpcore.http11 - DEBUG - response_closed.started
2025-07-30 06:37:28,845 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-30 06:37:28,848 - openai._base_client - DEBUG - HTTP Response: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "200 OK" Headers({'vary': 'Origin,Access-Control-Request-Method,Access-Control-Request-Headers, Accept-Encoding', 'x-request-id': 'e6e0fde2-4359-9c82-8dda-f61754f9b689', 'x-dashscope-call-gateway': 'true', 'content-type': 'application/json', 'req-cost-time': '428', 'req-arrive-time': '1753828648208', 'resp-start-time': '1753828648637', 'x-envoy-upstream-service-time': '428', 'set-cookie': 'acw_tc=e6e0fde2-4359-9c82-8dda-f61754f9b689bb092671a222ae572bc4d021dabf652e;path=/;HttpOnly;Max-Age=1800', 'content-encoding': 'gzip', 'date': 'Tue, 29 Jul 2025 22:37:28 GMT', 'server': 'istio-envoy', 'transfer-encoding': 'chunked'})
2025-07-30 06:37:28,851 - openai._base_client - DEBUG - request_id: e6e0fde2-4359-9c82-8dda-f61754f9b689
2025-07-30 06:37:28,879 - ConnectionTester - INFO - Qwen API connection successful
2025-07-30 06:37:28,880 - ToolTester - INFO - Testing Dify chat tool...
2025-07-30 06:37:28,957 - DifyClient - INFO - Sending to Dify API: Hello, this is a test...
2025-07-30 06:37:28,958 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:37:28,958 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': 'Hello, this is a test', 'response_mode': 'blocking', 'user': 'default_user', 'conversation_id': '', 'files': []}
2025-07-30 06:37:35,485 - DifyClient - INFO - Response Status: 200
2025-07-30 06:37:35,486 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': 'b7e3c5f1-3475-48ee-bd1f-6880200f8443', 'id': '851b2f00-893c-4a66-bdf6-e23d040a2885', 'message_id': '851b2f00-893c-4a66-bdf6-e23d040a2885', 'conversation_id': '9a3382de-f861-4248-a43d-0ec01e45ca07', 'mode': 'advanced-chat', 'answer': '你好！欢迎开启我们的交流。我是MindMate，你的虚拟教研伙伴。\n\n我的功能是为教师提供启发性的教学建议，以及思维教学相关的理论与实践指导。\n\n如果你有相关的教学问题，可以向我提问哦。比如“如何在《三角形内角和》这节课中设计认知冲突？”“学生在学习《函数》概念时可能存在哪些迷思概念？”“《等差数列》的教学可以采用哪些变式教学？”“在《光合作用》这节课能够使用哪些思维工具来辅助教学？”', 'metadata': {'usage': {'prompt_tokens': 1674, 'prompt_unit_price': '0', 'prompt_price_unit': '0', 'prompt_price': '0.002234', 'completion_tokens': 594, 'completion_unit_price': '0', 'completion_price_unit': '0', 'completion_price': '0.000296', 'total_tokens': 2268, 'total_price': '0.00253', 'currency': 'USD', 'latency': 6.0381114380434155}}, 'created_at': 1753828649}
2025-07-30 06:37:35,488 - DifyClient - INFO - [SUCCESS] Dify response: 你好！欢迎开启我们的交流。我是MindMate，你的虚拟教研伙伴。

我的功能是为教师提供启发性的教学建议，以及思维教学相关的理论与实践指导。

如果你有相关的教学问题，可以向我提问哦。比如“如何在《...
2025-07-30 06:37:35,489 - ToolTester - INFO - Dify chat tool test successful
2025-07-30 06:37:35,490 - ToolTester - INFO - Testing get time tool...
2025-07-30 06:37:35,491 - ToolTester - INFO - Get time tool test successful
2025-07-30 06:37:35,491 - ToolTester - INFO - Testing calculator tool...
2025-07-30 06:37:35,492 - ToolTester - INFO - Calculator tool test successful
2025-07-30 06:37:35,493 - agent - INFO - MindBotAgent v0.1 initialized successfully
2025-07-30 06:37:35,494 - AgentTester - INFO - Testing agent tool calling...
2025-07-30 06:37:35,495 - agent - INFO - Processing: What time is it?...
2025-07-30 06:37:35,496 - agent - INFO - User: unknown
2025-07-30 06:37:35,496 - agent - INFO - Calling Dify API...
2025-07-30 06:37:35,497 - DifyClient - INFO - Sending to Dify API: What time is it?...
2025-07-30 06:37:35,499 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:37:35,500 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': 'What time is it?', 'response_mode': 'blocking', 'user': 'unknown', 'conversation_id': '', 'files': []}
2025-07-30 06:37:42,729 - DifyClient - INFO - Response Status: 200
2025-07-30 06:37:42,730 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '93f278ac-2e6d-4f0b-8143-34f6b207c94e', 'id': '1ab99eef-7220-40d7-a6d6-f6c2f56d2816', 'message_id': '1ab99eef-7220-40d7-a6d6-f6c2f56d2816', 'conversation_id': '68e14b8c-b432-4c56-847e-cc3dc384377d', 'mode': 'advanced-chat', 'answer': '你好呀，这个问题与我作为思维教学专家的职能无关哦。我是MindMate，是一位专业的虚拟教研伙伴，专门为教师提供启发性教学建议，以及思维教学相关的理论与实践指导呢。如果你有教学方面的问题，可以问我，比如“如何在《三角形内角和》这节课设计认知冲突？”“学生在《函数概念》上可能存在哪些迷思概念？”“数列问题可以开展什么样的变式教学？”“几何证明题可以运用哪些思维工具来讲解？”', 'metadata': {'usage': {'prompt_tokens': 1668, 'prompt_unit_price': '0', 'prompt_price_unit': '0', 'prompt_price': '0.002228', 'completion_tokens': 591, 'completion_unit_price': '0', 'completion_price_unit': '0', 'completion_price': '0.000296', 'total_tokens': 2259, 'total_price': '0.002524', 'currency': 'USD', 'latency': 6.6993193831294775}}, 'created_at': 1753828656}
2025-07-30 06:37:42,732 - DifyClient - INFO - [SUCCESS] Dify response: 你好呀，这个问题与我作为思维教学专家的职能无关哦。我是MindMate，是一位专业的虚拟教研伙伴，专门为教师提供启发性教学建议，以及思维教学相关的理论与实践指导呢。如果你有教学方面的问题，可以问我，比...
2025-07-30 06:37:42,733 - agent - INFO - Dify response: 你好呀，这个问题与我作为思维教学专家的职能无关哦。我是MindMate，是一位专业的虚拟教研伙伴，专门为教师提供启发性教学建议，以及思维教学相关的理论与实践指导呢。如果你有教学方面的问题，可以问我，比...
2025-07-30 06:37:42,734 - AgentTester - INFO - Test case 'What time is it?' passed
2025-07-30 06:37:42,736 - agent - INFO - Processing: Calculate 10 + 5...
2025-07-30 06:37:42,737 - agent - INFO - User: unknown
2025-07-30 06:37:42,738 - agent - INFO - Calling Dify API...
2025-07-30 06:37:42,739 - DifyClient - INFO - Sending to Dify API: Calculate 10 + 5...
2025-07-30 06:37:42,739 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:37:42,741 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': 'Calculate 10 + 5', 'response_mode': 'blocking', 'user': 'unknown', 'conversation_id': '', 'files': []}
2025-07-30 06:37:47,119 - DifyClient - INFO - Response Status: 200
2025-07-30 06:37:47,139 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '94ac8f25-6d65-4023-afe1-73696f068a4a', 'id': '04bb4043-f0a0-4cc4-a11d-d1242757590e', 'message_id': '04bb4043-f0a0-4cc4-a11d-d1242757590e', 'conversation_id': '074237c0-f9ee-4732-b27d-f35c6520d703', 'mode': 'advanced-chat', 'answer': '10 + 5= 15。\n\n不过，我想问问你：你是想快速得到答案，还是希望通过这个简单的计算来练习某种思维方法？比如，我们可以用逆向思考法来问：“如果结果是15，那两个加数可能是什么？”这样能帮你从不同角度理解数字关系。你想试试吗？', 'metadata': {'retriever_resources': [{'position': 1, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '6671e105-6380-45e8-b2f6-cea8ab4ce9cf', 'document_name': '显性直接教学的概念演进、核心内涵与实践启示.docx', 'data_source_type': 'upload_file', 'segment_id': 'd435f558-d16b-400b-a92a-5ded657f72ab', 'retriever_from': 'workflow', 'score': 0.28694129321735123, 'hit_count': 522, 'word_count': 1006, 'segment_position': 1, 'index_node_hash': '48f58f5dacdc22d0e5f927da9133b4a73c84a49f58411fa36ff323d6234f2b97', 'content': '显性直接教学的概念演进、核心内涵与实践启示\n正文部分\n一、钟摆现象：直接教学与间接教学的争论与争鸣\n教育改革强调的重点总是在相互对立的理念间来回摇摆，这种现象被称为教育改革的“钟摆现象”以美国教育改革为例，19 世纪末 20 世纪初，以赫尔巴特为代表的传统教育处于主导地位；20 世纪初，以杜威为代表的进步教育开始独占鳌头；二战之后国际局势发生急剧变化，特别是在受到苏联成功发射第一颗人造卫星的强大冲击后，美国教育领域又响起“回到基础”的号召，突出教师主导地位的传统教育重新成为主流；但是随之而来的学生学习负担过重等不良现象又让美国教育面临新的危机，1970 年推行的《课堂上的危机：美国教育的改造》再次强调教师只是学生学习的“顾问”，教育的钟摆又重新荡向“进步教育”的一极 “钟摆现象”在教学法层面同样存在总体来看，课堂教学模式可分为以讲授法、演示法为典型代表的直接类教学（也称接受式学习）和以探究式学习、项目式学习为代表的间接类教学（也称发现式学习）两大类直接教学和间接教学的争论可谓旷日持久，有文字记载的可以追溯到春秋时期，如荀子“终日而思不如须臾之所学”的思想可以看作是推崇直接教学的典型代表；三国时蜀汉及西晋时陈寿的“书读百遍而义自见”则渗透着强调“悟”的间接教学思想；而大教育家孔子“不愤不启，不悱不发”的启发式教学则是直接教学（“启”和“发”）和间接教学（“愤”和“悱”）的有机结合近半个世纪以来，以探究式学习、项目式学习、小组协作学习等为代表的体现“学生中心”特色的间接类教学方法得到了极大推崇美国科学促进会于 1985 年启动了“2061 计划”，倡导学生通过“科学探究”“做中学”的方式进行学习2002 年，美国率先启动了“21 世纪技能”的研究，强调培养学生的批判性思维、创造力、交流和协作能力（又称为“4C”）国内教育改革也紧随这一趋势，我国教育部 2001 年颁布的《基础教育课程改革纲要（试行）》提出要改变课程“过于注重知识传授倾向”“过于强调接受学习、死记硬背、机械训练”等现状，提出要形成“积极主动的学习态度”、倡导“学生主动参与”“乐于探究”的新方向2023 年，教育部办公厅印发了《基础教育课程教学改革深化行动方案》，明确提出要“尊重学生主体地位”“发挥教师主导作用”“注重启发式、互动式、探究式教学”，克服“单纯教师讲学生听”等现象，引导学生“主动思考、积极提问、自主探究”', 'page': None, 'doc_metadata': None}, {'position': 2, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '5fe54de9-20ba-4701-8882-242041456366', 'document_name': '【排版结果】概念图、思维导图教学应用若干重要问题的探讨.docx', 'data_source_type': 'upload_file', 'segment_id': 'bf58b72f-9a93-439f-ba40-44dc4c086a60', 'retriever_from': 'workflow', 'score': 0.13565187662647782, 'hit_count': 150, 'word_count': 922, 'segment_position': 1, 'index_node_hash': '0cb5ad52675f1ef2e1690b7e8c5a450cd1a2a926e7148ad8adb2f40ca6e26e04', 'content': '概念图、思维导图教学应用若干重要问题的探讨\n一、引言\n概念图 [1] 和思维导图 [2] 作为两种有效的知识可视化工具，[3][4] 从诞生之日起就一直受到较高的关注在中国，第一篇介绍概念图和思维导图的学术论文分别开始于 1990 年 [5] 和 2000 年[6] 在 1990—2000 年这十年中，国内一共只有五篇介绍性的论文进入 21 世纪，社会转型和教育变革对教学方式提出了新的要求，概念图和思维导图也逐步进入广大教育工作者的视野从 2001 年到 2011 年，发表的相关学术论文数量逐年递增截至 2011 年 10 月，以 “概念图” 和 “思维导图” 为主题词，可以在 CNKI 上检索到相关论文 579 篇（剔除计算机领域对应英文为 Conceptual Graph 的 “概念图” 和化学领域的 “有机概念图”），关注焦点也逐步从理论探讨向教学应用转变，实践应用型论文占比已超过 80%一方面，国内的概念图、思维导图已经实现从理论研究向实践应用的转化，研究与应用的热情也异常高涨但另一方面，大量问题也从实践中暴露出来，主要体现在：研究质量不高、研究创新少、实证研究少、理论提升不够等方面[7][8][9][10][11]\n笔者于 2002 年接触概念图和思维导图，在随后的近十年间一直从事相关的研究和实践工作，与广大一线研究者有着较好的沟通2011 年 5 月，笔者受广东省佛山市顺德区勒流中学邀请，为全校师生做了一场有关《概念图、思维导图与学科深层次整合》的讲座由于笔者曾于 2007 年 1 月到顺德讲授概念图和思维导图，勒流中学随后开展了长达四年的思维导图、概念图教学应用实践，所以笔者提议改变讲座形式，由教师提出一些实践中经常遇到的典型问题，将讲座从单向的知识传递转变为双向的互动交流针对勒流中学教师的提问，结合近年来的研究心得，特整理此文以供参考\n本文首先深入探讨概念图和思维导图的本质，从而厘清概念图和思维导图的异同及其各自优势；然后针对实践过程中常遇到的问题进行探讨，努力将概念图和思维导图的使用向发挥实效方向提升；第三部分则对如何在实践过程中开展研究提出几点建议；最后分析思维导图和概念图的研究热点和发展趋势', 'page': None, 'doc_metadata': None}, {'position': 3, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '4f7f7655-eea0-4546-bb87-1494e3d06dfd', 'retriever_from': 'workflow', 'score': 0.016151430134768333, 'hit_count': 259, 'word_count': 16, 'segment_position': 176, 'index_node_hash': 'b1eeb8ca110e1871051e62937ca3ba698bfe6a8be1316b69db49bfdffa705d72', 'content': 'question:逆向思考法如何帮助解决复杂问题？ \nanswer:逆向思考法通过从目标或结果出发进行反向推导，能够有效打破传统的线性思维模式，避免陷入局部最优解或惯性思维。这种方法可以帮助我们更清晰地识别关键障碍和必要条件，从而设计出更具创新性和系统性的解决方案，特别适用于复杂、多变量的问题情境。', 'page': None, 'doc_metadata': None}, {'position': 4, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '46771f82-a02f-4a78-a8b9-84d3d639fab0', 'retriever_from': 'workflow', 'score': 0.014226086287585659, 'hit_count': 111, 'word_count': 14, 'segment_position': 173, 'index_node_hash': 'c8777739d138bfaa1e6e33abc189af0a8ae8bddedc200f66ddad0d76fba40426', 'content': 'question:逆向思考法的主要用途是什么？ \nanswer:逆向思考法的主要用途是进行反向推导，即从预期的结果或目标出发，逐步回溯到当前状态或起点，从而识别出达成目标所需的具体步骤。这种训练有助于提升思维的灵活性和创造性，尤其在面对复杂或难以用常规方法解决的问题时效果显著。', 'page': None, 'doc_metadata': None}], 'usage': {'prompt_tokens': 2875, 'prompt_unit_price': '0.0003', 'prompt_price_unit': '0.001', 'prompt_price': '0.0027614', 'completion_tokens': 109, 'completion_unit_price': '0.0006', 'completion_price_unit': '0.001', 'completion_price': '0.0003466', 'total_tokens': 2984, 'total_price': '0.003108', 'currency': 'RMB', 'latency': 2.6576374862343073}}, 'created_at': 1753828663}
2025-07-30 06:37:47,146 - DifyClient - INFO - [SUCCESS] Dify response: 10 + 5= 15。

不过，我想问问你：你是想快速得到答案，还是希望通过这个简单的计算来练习某种思维方法？比如，我们可以用逆向思考法来问：“如果结果是15，那两个加数可能是什么？”这样能帮你从不同...
2025-07-30 06:37:47,149 - agent - INFO - Dify response: 10 + 5= 15。

不过，我想问问你：你是想快速得到答案，还是希望通过这个简单的计算来练习某种思维方法？比如，我们可以用逆向思考法来问：“如果结果是15，那两个加数可能是什么？”这样能帮你从不同...
2025-07-30 06:37:47,150 - AgentTester - INFO - Test case 'Calculate 10 + 5' passed
2025-07-30 06:37:47,151 - agent - INFO - Processing: Hello, how are you?...
2025-07-30 06:37:47,151 - agent - INFO - User: unknown
2025-07-30 06:37:47,152 - agent - INFO - Calling Dify API...
2025-07-30 06:37:47,153 - DifyClient - INFO - Sending to Dify API: Hello, how are you?...
2025-07-30 06:37:47,155 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:37:47,157 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': 'Hello, how are you?', 'response_mode': 'blocking', 'user': 'unknown', 'conversation_id': '', 'files': []}
2025-07-30 06:37:54,409 - DifyClient - INFO - Response Status: 200
2025-07-30 06:37:54,411 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '52a68068-3afb-4634-a4df-2d2f914e926d', 'id': '60ba373b-41ef-434e-8289-446a73a49b82', 'message_id': '60ba373b-41ef-434e-8289-446a73a49b82', 'conversation_id': '17e60ce5-bb9a-4188-9990-8391df7c47c9', 'mode': 'advanced-chat', 'answer': 'Hello! I\'m doing great, thank you! I\'m MindMate, your virtual teaching - research partner. I\'m an expert in "thinking - development - oriented classrooms". My function is to provide teachers with inspiring teaching suggestions, as well as relevant theories and practical guidance in thinking teaching. If you have any questions related to teaching, you can ask me. For example, you can ask me "How to design cognitive conflicts in the \'Geometry\' lesson?" "What are the misconceptions that students may have about the \'function\' concept?" "What kind of variant teaching can be designed for the \'quadratic equation\'?" "Which thinking tools can be used in the \'chemical reaction rate\' lesson?"', 'metadata': {'usage': {'prompt_tokens': 1674, 'prompt_unit_price': '0', 'prompt_price_unit': '0', 'prompt_price': '0.002234', 'completion_tokens': 601, 'completion_unit_price': '0', 'completion_price_unit': '0', 'completion_price': '0.000352', 'total_tokens': 2275, 'total_price': '0.002586', 'currency': 'USD', 'latency': 6.704062661156058}}, 'created_at': 1753828667}
2025-07-30 06:37:54,411 - DifyClient - INFO - [SUCCESS] Dify response: Hello! I'm doing great, thank you! I'm MindMate, your virtual teaching - research partner. I'm an ex...
2025-07-30 06:37:54,413 - agent - INFO - Dify response: Hello! I'm doing great, thank you! I'm MindMate, your virtual teaching - research partner. I'm an ex...
2025-07-30 06:37:54,413 - AgentTester - INFO - Test case 'Hello, how are you?' passed
2025-07-30 06:37:54,414 - AgentTester - INFO - Agent tool calling test completed: 3/3 passed
2025-07-30 06:37:54,414 - debug - INFO - === DIAGNOSTICS SUMMARY ===
2025-07-30 06:37:54,415 - debug - INFO - Configuration: PASS
2025-07-30 06:37:54,415 - debug - INFO - Dify Connection: PASS
2025-07-30 06:37:54,416 - debug - INFO - Qwen Connection: PASS
2025-07-30 06:37:54,416 - debug - INFO - Tool Tests: 3/3 PASS
2025-07-30 06:37:54,417 - debug - INFO - Agent Test: PASS
2025-07-30 06:37:54,418 - debug - INFO - Overall Status: PASS
2025-07-30 06:37:54,419 - debug - INFO - Diagnostics completed
2025-07-30 06:37:54,420 - debug - INFO - Starting DingTalk Stream Client...
2025-07-30 06:37:54,420 - DingTalkStream - INFO - Starting DingTalk Stream Client v0.1...
2025-07-30 06:37:54,421 - DingTalkStream - INFO - Starting DingTalk client in main event loop...
2025-07-30 06:37:54,421 - DingTalkStream - INFO - Registered message handler with topic: /v1.0/im/bot/messages/get
2025-07-30 06:37:54,422 - DingTalkStream - INFO - MessageHandler pre_start called for robot: MindBot_poc (dingr6bg0cj9ylmlpuqz)
2025-07-30 06:37:54,423 - dingtalk_stream.client - INFO - open connection, url=https://api.dingtalk.com/v1.0/gateway/connections/open
2025-07-30 06:37:54,430 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.dingtalk.com:443
2025-07-30 06:37:55,530 - urllib3.connectionpool - DEBUG - https://api.dingtalk.com:443 "POST /v1.0/gateway/connections/open HTTP/1.1" 200 None
2025-07-30 06:37:55,534 - dingtalk_stream.client - INFO - endpoint is {'endpoint': 'wss://wss-open-connection.dingtalk.com:443/connect', 'ticket': 'ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb'}
2025-07-30 06:37:55,578 - websockets.client - DEBUG - = connection is CONNECTING
2025-07-30 06:37:56,501 - websockets.client - DEBUG - > GET /connect?ticket=ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb HTTP/1.1
2025-07-30 06:37:56,502 - websockets.client - DEBUG - > Host: wss-open-connection.dingtalk.com
2025-07-30 06:37:56,503 - websockets.client - DEBUG - > Upgrade: websocket
2025-07-30 06:37:56,504 - websockets.client - DEBUG - > Connection: Upgrade
2025-07-30 06:37:56,504 - websockets.client - DEBUG - > Sec-WebSocket-Key: IKZMk5rzkw5bZC6DaULwWw==
2025-07-30 06:37:56,505 - websockets.client - DEBUG - > Sec-WebSocket-Version: 13
2025-07-30 06:37:56,506 - websockets.client - DEBUG - > Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits
2025-07-30 06:37:56,507 - websockets.client - DEBUG - > User-Agent: Python/3.13 websockets/15.0.1
2025-07-30 06:37:57,002 - websockets.client - DEBUG - < HTTP/1.1 101 Switching Protocols
2025-07-30 06:37:57,003 - websockets.client - DEBUG - < Upgrade: websocket
2025-07-30 06:37:57,003 - websockets.client - DEBUG - < Connection: Upgrade
2025-07-30 06:37:57,004 - websockets.client - DEBUG - < Sec-WebSocket-Accept: 7AI0l/XWYSeJd4p6xTKL05SBCRU=
2025-07-30 06:37:57,004 - websockets.client - DEBUG - = connection is OPEN
2025-07-30 06:38:17,013 - websockets.client - DEBUG - > PING b0 c6 71 13 [binary, 4 bytes]
2025-07-30 06:38:17,015 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:38:17,466 - websockets.client - DEBUG - < PONG b0 c6 71 13 [binary, 4 bytes]
2025-07-30 06:38:17,468 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:38:17,507 - websockets.client - DEBUG - < TEXT '{"specVersion":"1.0","type":"CALLBACK","headers...sgtype\\":\\"text\\"}"}' [1068 bytes]
2025-07-30 06:38:17,508 - DingTalkStream - INFO - MessageHandler.raw_process invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb, content_type=application/json, message_id=2166fa57_c20_19830cc0437_18cb04b, time=1753828697358, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:38:17,508 - DingTalkStream - INFO - MessageHandler.__call__ invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb, content_type=application/json, message_id=2166fa57_c20_19830cc0437_18cb04b, time=1753828697358, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:38:17,509 - DingTalkStream - INFO - --- MESSAGE RECEIVED ---
2025-07-30 06:38:17,509 - DingTalkStream - INFO - Message type: <class 'dingtalk_stream.frames.CallbackMessage'>
2025-07-30 06:38:17,509 - DingTalkStream - DEBUG - Message data: {'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}
2025-07-30 06:38:17,510 - DingTalkStream - INFO - Text: 测试
2025-07-30 06:38:17,510 - DingTalkStream - INFO - User: manager7439
2025-07-30 06:38:17,510 - DingTalkStream - INFO - Conversation: cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=
2025-07-30 06:38:17,510 - DingTalkStream - INFO - Message ID: msgSTKmRmtmUhxcOEacopmxwA==
2025-07-30 06:38:17,510 - DingTalkStream - INFO - [SUCCESS] Received: 测试...
2025-07-30 06:38:17,511 - DingTalkStream - INFO - Calling AI Agent...
2025-07-30 06:38:17,511 - debug - INFO - Processing message: 测试...
2025-07-30 06:38:17,511 - debug - INFO - Sending to AI Agent...
2025-07-30 06:38:17,511 - agent - INFO - Processing: 测试...
2025-07-30 06:38:17,512 - agent - INFO - User: manager7439
2025-07-30 06:38:17,512 - agent - INFO - Calling Dify API...
2025-07-30 06:38:17,512 - DifyClient - INFO - Sending to Dify API: 测试...
2025-07-30 06:38:17,513 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:38:17,513 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': '测试', 'response_mode': 'blocking', 'user': 'manager7439', 'conversation_id': '', 'files': []}
2025-07-30 06:38:21,451 - DifyClient - INFO - Response Status: 200
2025-07-30 06:38:21,505 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '84716a81-4101-4a42-bef2-94fa3053e38a', 'id': '8ecb4020-e575-4d63-b9fb-553f2acb5765', 'message_id': '8ecb4020-e575-4d63-b9fb-553f2acb5765', 'conversation_id': '62bae356-1d4f-401d-89c4-f492ba1579fb', 'mode': 'advanced-chat', 'answer': '测试通过！  \n你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教学工具的应用、课堂设计策略、学生思维发展评估等，我会以专业顾问的身份，给你结构化、有深度的回答。  \n\n现在轮到你提问啦——你想探讨哪个方面的思维教学？', 'metadata': {'retriever_resources': [{'position': 1, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '2d01753e-80db-4095-a091-24eab81d8e3e', 'document_name': '思维教学本体知识库.docx', 'data_source_type': 'upload_file', 'segment_id': 'b3b1c201-03f1-4892-859b-6d47191a4def', 'retriever_from': 'workflow', 'score': 0.3992887645281183, 'hit_count': 2880, 'word_count': 654, 'segment_position': 1, 'index_node_hash': 'a7d98932d277b7cf4c305285e9cef29d3611bf87f960230eea11eb38c8183bbc', 'content': '思维教学的理论基础：马扎诺教育目标分类学\n安德森认知目标分类学\n最近发展区理论\n意义学习理论\nKI教学理论\n关于思维的知识\n思维的基本形式：\n直觉思维\n形象思维\n逻辑思维\n思维的基本过程：\n联想\n想象\n比较\n分类\n分析\n综合\n抽象\n概括\n判断\n演绎推理\n归纳推理\n关于思维教学的知识(CK-teachingthinking)\n思维教学的通用性与特定性：通用思维教学：批判性思维；创造性思维\n特定领域思维教学：数学思维，科学思维，设计思维，工程思维等特定学科相关的思维能力\n思维教学的直接性与间接性：\n直接思维教学，\n融入式思维教学\n关于思维工具的知识（TK）\n思维可视化工具：\n八大思维图示\n思维导图\n概念图\n思维策略工具：\n思维指引工具：目标分析法、三维分析法、因素分析法、优先分析法、可能分析法、换位分析法、结果分析法\n思维激发工具：问题重定义、随机输入、概念扇、逆向思考法\n思维组织工具：四何分析法、WHWM、四象限法、概念化、具体化\n柯尔特思维工具等其他思维工具\n关于思维教学法的知识（PK）\n认知冲突法\nKI教学理论\nPOE教学法\n变式教学法\n认知建模\n理解检查\n关于思维教学评价的知识-元认知：SOLO分类模型、KI量规、创造性思维测评量表托兰斯创造性测验（TTCT）威廉姆斯创造力倾向量表（WCS）Mednick的远程联想测试（RAT）、批判性思维测评量表加州批判性思维倾向量表（CCTDI）加州批判性思维技能量表（CCTST）\n关于学生思维的知识\n对学生最近发展区的测定\n对学生迷思概念的预设', 'page': None, 'doc_metadata': None}, {'position': 2, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '1fd9a854-39ab-451d-b872-fe0749c3c906', 'document_name': '论可视化工具教学应用的原则和着力点.docx', 'data_source_type': 'upload_file', 'segment_id': '2bf97637-46dc-49e2-ae6c-c22c67be3558', 'retriever_from': 'workflow', 'score': 0.21413748936554108, 'hit_count': 438, 'word_count': 915, 'segment_position': 1, 'index_node_hash': '37889cc017ee2d7250d535b9311f0f2fe8d3e61836ee60140fb5e441bc361882', 'content': '论思维可视化工具教学应用的原则和着力点\n赵国庆， 杨宣洋， 熊雅雯\n（北京师范大学 教育学部， 北京 100875）\n摘要\n在以“核心素养”为导向的新一轮教学改革中，思维可视化工具受到了师生们的广泛欢迎并逐渐成为推动课堂教学变革的重要抓手然而，一线教师对思维可视化工具的作用机理及不同工具间的差异认识尚不深入，因而在教学应用时难以准确把握促进学生思维发展的着力点文章旨在探讨思维可视化工具教学应用的指导原则，分析八大思维图示法、思维导图和概念图三大典型可视化工具间的核心差异并找出其在教学应用中的具体着力点文章认为：（1）思维工具的作用机理在于帮助学习者分担低阶认知负荷，从而让他们得以更好地参与到高阶认知加工中去；（2）在教学应用中，教师应坚持学生主体、以问题解决为导向、结合思维策略工具、尊重学生已有认知，在学生思维发展的最近发展区寻找着力点并加以干预；（3）八大思维图示法是具体思维方式的具体表示法，思维导图是综合多种思维方式的模糊表示法，概念图是综合多种思维方式的精确表示法，三者在教学应用中着力点也有所不同\n关键词\n思维可视化； 工具； 思维策略； 概念图； 思维导图； 八大思维图示法\n一、研究背景及问题\n随着以“核心素养”为导向的新一轮教学改革的快速推进，作为“核心素养之核心”的思维能力得到了越来越多的重视为促进“高阶思维能力发展”这一目标的有效达成，广大中小学教师都在努力寻找有效手段由于具有较高的易用性和较强的实用性，以八大思维图示法（Thinking Maps，也译作思维地图）、思维导图（Mind Maps，也译作心智图或脑图）和概念图（Concept Maps）等为代表的思维可视化工具受到了师生们的广泛欢迎，并逐渐成为推动课堂教学变革、实现深度学习的重要抓手2012 年，赵姝和赵国庆等提出，将“思维训练作为技术促进学习的催化剂”，并将“隐性思维显性化”置于思维训练三阶段的第一个阶段，这与思维可视化工具在教学中得到越来越广泛应用的现状相一致\n尽管思维可视化工具的应用如火如荼，但从教师们在期刊、会议或网络上发表的论文以及分享的教学案例来看，思维可视化工具的应用水平整体还不够高，深入创新应用还比较欠缺', 'page': None, 'doc_metadata': None}, {'position': 3, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '325b8b3e-ee07-4872-b2a4-f5e579d7707c', 'retriever_from': 'workflow', 'score': 0.10983448003190108, 'hit_count': 203, 'word_count': 21, 'segment_position': 121, 'index_node_hash': '77e710b052ce11213efc6185deca50602b3465dba451782ce03876c832d54cbf', 'content': 'question:问题重定义工具对哪种能力的培养有重要作用？ \nanswer:问题重定义工具对于创造性思维的培养具有重要作用。它鼓励人们突破固有的思维模式，从不同角度看待问题，从而提升创新能力与问题解决能力。', 'page': None, 'doc_metadata': None}, {'position': 4, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '8515fc9f-b33e-4803-94c9-f7a638d72718', 'retriever_from': 'workflow', 'score': 0.08474336500103583, 'hit_count': 72, 'word_count': 16, 'segment_position': 64, 'index_node_hash': '1beb2ccbf43f188c51dfd845bffe8147208a7c15b7294b3b675730ccc005796e', 'content': 'question:“可能分析法”的主要用途是什么？ \nanswer:“可能分析法”的主要用途是探索问题的各种可能性，包括潜在的解决方案和未来的发展趋势。它有助于在决策过程中识别和评估各种风险与机会。', 'page': None, 'doc_metadata': None}], 'usage': {'prompt_tokens': 2474, 'prompt_unit_price': '0.0003', 'prompt_price_unit': '0.001', 'prompt_price': '0.0026156', 'completion_tokens': 96, 'completion_unit_price': '0.0006', 'completion_price_unit': '0.001', 'completion_price': '0.0002722', 'total_tokens': 2570, 'total_price': '0.0028878', 'currency': 'RMB', 'latency': 2.2098829206079245}}, 'created_at': 1753828698}
2025-07-30 06:38:21,506 - DifyClient - INFO - [SUCCESS] Dify response: 测试通过！  
你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教学工具的应用、课堂设计策略、学生思维发展评估等，我会以专业顾问的身份，给你结构化、有深度的回答。  ...
2025-07-30 06:38:21,507 - agent - INFO - Dify response: 测试通过！  
你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教学工具的应用、课堂设计策略、学生思维发展评估等，我会以专业顾问的身份，给你结构化、有深度的回答。  ...
2025-07-30 06:38:21,507 - debug - INFO - Generated response: 测试通过！  
你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教...
2025-07-30 06:38:21,508 - DingTalkStream - INFO - [SUCCESS] Agent response: 测试通过！  
你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教...
2025-07-30 06:38:21,508 - DingTalkStream - INFO - Sending reply to DingTalk...
2025-07-30 06:38:21,718 - DingTalkStream - INFO - [SUCCESS] Reply sent successfully: 测试通过！  
你已经成功触发了mindmate的测试模式。接下来你可以提出具体问题，比如关于思维教...
2025-07-30 06:38:21,719 - DingTalkStream - INFO - --- MESSAGE HANDLED ---
2025-07-30 06:38:29,829 - websockets.client - DEBUG - < TEXT '{"specVersion":"1.0","type":"CALLBACK","headers...sgtype\\":\\"text\\"}"}' [1068 bytes]
2025-07-30 06:38:29,831 - DingTalkStream - INFO - MessageHandler.raw_process invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb, content_type=application/json, message_id=2166e316_c38_19830d3f902_18bfd5d, time=1753828709677, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:38:29,832 - DingTalkStream - INFO - MessageHandler.__call__ invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=ab7e6b32-6ccc-11f0-bee8-0eb3b764c0bb, content_type=application/json, message_id=2166e316_c38_19830d3f902_18bfd5d, time=1753828709677, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:38:29,832 - DingTalkStream - INFO - --- MESSAGE RECEIVED ---
2025-07-30 06:38:29,833 - DingTalkStream - INFO - Message type: <class 'dingtalk_stream.frames.CallbackMessage'>
2025-07-30 06:38:29,833 - DingTalkStream - DEBUG - Message data: {'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}
2025-07-30 06:38:29,834 - DingTalkStream - INFO - Text: 你好
2025-07-30 06:38:29,835 - DingTalkStream - INFO - User: manager7439
2025-07-30 06:38:29,836 - DingTalkStream - INFO - Conversation: cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=
2025-07-30 06:38:29,837 - DingTalkStream - INFO - Message ID: msgd2DhLcmG91/7nYDtk6KJcQ==
2025-07-30 06:38:29,838 - DingTalkStream - INFO - [SUCCESS] Received: 你好...
2025-07-30 06:38:29,839 - DingTalkStream - INFO - Calling AI Agent...
2025-07-30 06:38:29,840 - debug - INFO - Processing message: 你好...
2025-07-30 06:38:29,841 - debug - INFO - Sending to AI Agent...
2025-07-30 06:38:29,842 - agent - INFO - Processing: 你好...
2025-07-30 06:38:29,842 - agent - INFO - User: manager7439
2025-07-30 06:38:29,843 - agent - INFO - Calling Dify API...
2025-07-30 06:38:29,843 - DifyClient - INFO - Sending to Dify API: 你好...
2025-07-30 06:38:29,844 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:38:29,844 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': '你好', 'response_mode': 'blocking', 'user': 'manager7439', 'conversation_id': '', 'files': []}
2025-07-30 06:38:37,023 - websockets.client - DEBUG - > PING dd d3 07 8a [binary, 4 bytes]
2025-07-30 06:38:37,025 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:38:37,067 - DifyClient - INFO - Response Status: 200
2025-07-30 06:38:37,068 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': 'f1429aa0-456e-4cae-bd98-00cdb86e791a', 'id': '3beb2e80-fd91-4aae-ba7b-bc0d54021378', 'message_id': '3beb2e80-fd91-4aae-ba7b-bc0d54021378', 'conversation_id': '0740f32e-c361-49f8-ad62-c47a3f52f421', 'mode': 'advanced-chat', 'answer': '你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深专家。我可以为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。如果你有任何关于教学的问题都可以问我，比如像“如何在《勾股定理》这节课设置认知冲突？”“学生在学习《函数》概念时可能存在哪些迷思概念？”“《几何图形面积计算》可以开展哪些变式教学？”“《光合作用》这节课适合用哪些思维工具来辅助教学？”', 'metadata': {'usage': {'prompt_tokens': 1647, 'prompt_unit_price': '0', 'prompt_price_unit': '0', 'prompt_price': '0.002204', 'completion_tokens': 582, 'completion_unit_price': '0', 'completion_price_unit': '0', 'completion_price': '0.000296', 'total_tokens': 2229, 'total_price': '0.0025', 'currency': 'USD', 'latency': 6.716852921061218}}, 'created_at': 1753828710}
2025-07-30 06:38:37,069 - DifyClient - INFO - [SUCCESS] Dify response: 你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深专家。我可以为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。如果你有任何关于教学的问...
2025-07-30 06:38:37,071 - agent - INFO - Dify response: 你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深专家。我可以为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。如果你有任何关于教学的问...
2025-07-30 06:38:37,072 - debug - INFO - Generated response: 你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深...
2025-07-30 06:38:37,073 - DingTalkStream - INFO - [SUCCESS] Agent response: 你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深...
2025-07-30 06:38:37,074 - DingTalkStream - INFO - Sending reply to DingTalk...
2025-07-30 06:38:37,469 - DingTalkStream - INFO - [SUCCESS] Reply sent successfully: 你好呀！欢迎和我聊天呢。我是MindMate，是一位专业的虚拟教研伙伴，更是“思维发展型课堂”的资深...
2025-07-30 06:38:37,471 - DingTalkStream - INFO - --- MESSAGE HANDLED ---
2025-07-30 06:38:37,502 - websockets.client - DEBUG - < PONG dd d3 07 8a [binary, 4 bytes]
2025-07-30 06:38:37,503 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:38:45,843 - debug - INFO - Received signal 2, shutting down gracefully...
2025-07-30 06:38:45,844 - websockets.client - DEBUG - > CLOSE 1000 (OK) [2 bytes]
2025-07-30 06:38:45,844 - websockets.client - DEBUG - = connection is CLOSING
2025-07-30 06:38:46,294 - websockets.client - DEBUG - < CLOSE 1000 (OK) [2 bytes]
2025-07-30 06:38:46,295 - websockets.client - DEBUG - < EOF
2025-07-30 06:38:46,295 - websockets.client - DEBUG - > EOF
2025-07-30 06:38:46,296 - websockets.client - DEBUG - = connection is CLOSED
2025-07-30 06:38:46,297 - websockets.client - DEBUG - x closing TCP connection
2025-07-30 06:38:46,299 - dingtalk_stream.client - ERROR - [start] network exception, error=
2025-07-30 06:38:56,311 - dingtalk_stream.client - INFO - open connection, url=https://api.dingtalk.com/v1.0/gateway/connections/open
2025-07-30 06:38:56,313 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.dingtalk.com:443
2025-07-30 06:38:57,005 - urllib3.connectionpool - DEBUG - https://api.dingtalk.com:443 "POST /v1.0/gateway/connections/open HTTP/1.1" 200 None
2025-07-30 06:38:57,006 - dingtalk_stream.client - INFO - endpoint is {'endpoint': 'wss://wss-open-connection.dingtalk.com:443/connect', 'ticket': 'd0242c7a-6ccc-11f0-89fb-2eaa794b294e'}
2025-07-30 06:38:57,008 - websockets.client - DEBUG - = connection is CONNECTING
2025-07-30 06:38:57,955 - websockets.client - DEBUG - > GET /connect?ticket=d0242c7a-6ccc-11f0-89fb-2eaa794b294e HTTP/1.1
2025-07-30 06:38:57,956 - websockets.client - DEBUG - > Host: wss-open-connection.dingtalk.com
2025-07-30 06:38:57,956 - websockets.client - DEBUG - > Upgrade: websocket
2025-07-30 06:38:57,957 - websockets.client - DEBUG - > Connection: Upgrade
2025-07-30 06:38:57,957 - websockets.client - DEBUG - > Sec-WebSocket-Key: 97USKhcJ6ivO6VIuTg1DrQ==
2025-07-30 06:38:57,958 - websockets.client - DEBUG - > Sec-WebSocket-Version: 13
2025-07-30 06:38:57,958 - websockets.client - DEBUG - > Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits
2025-07-30 06:38:57,959 - websockets.client - DEBUG - > User-Agent: Python/3.13 websockets/15.0.1
2025-07-30 06:38:58,440 - websockets.client - DEBUG - < HTTP/1.1 101 Switching Protocols
2025-07-30 06:38:58,441 - websockets.client - DEBUG - < Upgrade: websocket
2025-07-30 06:38:58,441 - websockets.client - DEBUG - < Connection: Upgrade
2025-07-30 06:38:58,442 - websockets.client - DEBUG - < Sec-WebSocket-Accept: 2vwwsAJhzfLiDMPcVut3vm6oFhM=
2025-07-30 06:38:58,442 - websockets.client - DEBUG - = connection is OPEN
2025-07-30 06:39:17,527 - websockets.client - DEBUG - < TEXT '{"specVersion":"1.0","type":"CALLBACK","headers...sgtype\\":\\"text\\"}"}' [1068 bytes]
2025-07-30 06:39:17,527 - DingTalkStream - INFO - MessageHandler.raw_process invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=d0242c7a-6ccc-11f0-89fb-2eaa794b294e, content_type=application/json, message_id=2166fa57_c20_19830cc0437_18cb4ce, time=1753828757368, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:39:17,528 - DingTalkStream - INFO - MessageHandler.__call__ invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=d0242c7a-6ccc-11f0-89fb-2eaa794b294e, content_type=application/json, message_id=2166fa57_c20_19830cc0437_18cb4ce, time=1753828757368, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:39:17,528 - DingTalkStream - INFO - --- MESSAGE RECEIVED ---
2025-07-30 06:39:17,528 - DingTalkStream - INFO - Message type: <class 'dingtalk_stream.frames.CallbackMessage'>
2025-07-30 06:39:17,528 - DingTalkStream - DEBUG - Message data: {'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgSTKmRmtmUhxcOEacopmxwA==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834097340, 'createAt': 1753828697128, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '测试'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}
2025-07-30 06:39:17,529 - DingTalkStream - INFO - Text: 测试
2025-07-30 06:39:17,529 - DingTalkStream - INFO - User: manager7439
2025-07-30 06:39:17,529 - DingTalkStream - INFO - Conversation: cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=
2025-07-30 06:39:17,529 - DingTalkStream - INFO - Message ID: msgSTKmRmtmUhxcOEacopmxwA==
2025-07-30 06:39:17,529 - DingTalkStream - INFO - [SUCCESS] Received: 测试...
2025-07-30 06:39:17,529 - DingTalkStream - INFO - Calling AI Agent...
2025-07-30 06:39:17,529 - debug - INFO - Processing message: 测试...
2025-07-30 06:39:17,529 - debug - INFO - Sending to AI Agent...
2025-07-30 06:39:17,530 - agent - INFO - Processing: 测试...
2025-07-30 06:39:17,530 - agent - INFO - User: manager7439
2025-07-30 06:39:17,530 - agent - INFO - Calling Dify API...
2025-07-30 06:39:17,530 - DifyClient - INFO - Sending to Dify API: 测试...
2025-07-30 06:39:17,530 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:39:17,530 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': '测试', 'response_mode': 'blocking', 'user': 'manager7439', 'conversation_id': '', 'files': []}
2025-07-30 06:39:18,455 - websockets.client - DEBUG - > PING 7a e1 3e 97 [binary, 4 bytes]
2025-07-30 06:39:18,457 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:39:18,931 - websockets.client - DEBUG - < PONG 7a e1 3e 97 [binary, 4 bytes]
2025-07-30 06:39:18,932 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:39:21,769 - DifyClient - INFO - Response Status: 200
2025-07-30 06:39:21,804 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '212a3dfb-9213-4cd0-9fcc-1fbe3c0e3b7d', 'id': '93b67dd8-bdcc-4a54-8b9e-5c1ceb1e2074', 'message_id': '93b67dd8-bdcc-4a54-8b9e-5c1ceb1e2074', 'conversation_id': '434a6b12-5c58-4f54-bb09-fd1520bc134a', 'mode': 'advanced-chat', 'answer': '测试通过！  \n你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发展型课堂的具体问题，比如：\n\n- “如何在语文课中融入批判性思维训练？”  \n- “八大思维图示法和概念图的区别在哪里？”  \n- “怎样用POE教学法设计一节科学探究课？”  \n\n或者直接问我：“你觉得教师最容易忽视的思维教学切入点是什么？”  \n\n我随时准备以结构化方式帮你深入思考教学实践中的关键问题。', 'metadata': {'retriever_resources': [{'position': 1, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '2d01753e-80db-4095-a091-24eab81d8e3e', 'document_name': '思维教学本体知识库.docx', 'data_source_type': 'upload_file', 'segment_id': 'b3b1c201-03f1-4892-859b-6d47191a4def', 'retriever_from': 'workflow', 'score': 0.3992887645281183, 'hit_count': 2881, 'word_count': 654, 'segment_position': 1, 'index_node_hash': 'a7d98932d277b7cf4c305285e9cef29d3611bf87f960230eea11eb38c8183bbc', 'content': '思维教学的理论基础：马扎诺教育目标分类学\n安德森认知目标分类学\n最近发展区理论\n意义学习理论\nKI教学理论\n关于思维的知识\n思维的基本形式：\n直觉思维\n形象思维\n逻辑思维\n思维的基本过程：\n联想\n想象\n比较\n分类\n分析\n综合\n抽象\n概括\n判断\n演绎推理\n归纳推理\n关于思维教学的知识(CK-teachingthinking)\n思维教学的通用性与特定性：通用思维教学：批判性思维；创造性思维\n特定领域思维教学：数学思维，科学思维，设计思维，工程思维等特定学科相关的思维能力\n思维教学的直接性与间接性：\n直接思维教学，\n融入式思维教学\n关于思维工具的知识（TK）\n思维可视化工具：\n八大思维图示\n思维导图\n概念图\n思维策略工具：\n思维指引工具：目标分析法、三维分析法、因素分析法、优先分析法、可能分析法、换位分析法、结果分析法\n思维激发工具：问题重定义、随机输入、概念扇、逆向思考法\n思维组织工具：四何分析法、WHWM、四象限法、概念化、具体化\n柯尔特思维工具等其他思维工具\n关于思维教学法的知识（PK）\n认知冲突法\nKI教学理论\nPOE教学法\n变式教学法\n认知建模\n理解检查\n关于思维教学评价的知识-元认知：SOLO分类模型、KI量规、创造性思维测评量表托兰斯创造性测验（TTCT）威廉姆斯创造力倾向量表（WCS）Mednick的远程联想测试（RAT）、批判性思维测评量表加州批判性思维倾向量表（CCTDI）加州批判性思维技能量表（CCTST）\n关于学生思维的知识\n对学生最近发展区的测定\n对学生迷思概念的预设', 'page': None, 'doc_metadata': None}, {'position': 2, 'dataset_id': 'a5ecd9b2-9683-4252-8c4b-f9dc980fad1a', 'dataset_name': '思维教学', 'document_id': '1fd9a854-39ab-451d-b872-fe0749c3c906', 'document_name': '论可视化工具教学应用的原则和着力点.docx', 'data_source_type': 'upload_file', 'segment_id': '2bf97637-46dc-49e2-ae6c-c22c67be3558', 'retriever_from': 'workflow', 'score': 0.21413748936554108, 'hit_count': 439, 'word_count': 915, 'segment_position': 1, 'index_node_hash': '37889cc017ee2d7250d535b9311f0f2fe8d3e61836ee60140fb5e441bc361882', 'content': '论思维可视化工具教学应用的原则和着力点\n赵国庆， 杨宣洋， 熊雅雯\n（北京师范大学 教育学部， 北京 100875）\n摘要\n在以“核心素养”为导向的新一轮教学改革中，思维可视化工具受到了师生们的广泛欢迎并逐渐成为推动课堂教学变革的重要抓手然而，一线教师对思维可视化工具的作用机理及不同工具间的差异认识尚不深入，因而在教学应用时难以准确把握促进学生思维发展的着力点文章旨在探讨思维可视化工具教学应用的指导原则，分析八大思维图示法、思维导图和概念图三大典型可视化工具间的核心差异并找出其在教学应用中的具体着力点文章认为：（1）思维工具的作用机理在于帮助学习者分担低阶认知负荷，从而让他们得以更好地参与到高阶认知加工中去；（2）在教学应用中，教师应坚持学生主体、以问题解决为导向、结合思维策略工具、尊重学生已有认知，在学生思维发展的最近发展区寻找着力点并加以干预；（3）八大思维图示法是具体思维方式的具体表示法，思维导图是综合多种思维方式的模糊表示法，概念图是综合多种思维方式的精确表示法，三者在教学应用中着力点也有所不同\n关键词\n思维可视化； 工具； 思维策略； 概念图； 思维导图； 八大思维图示法\n一、研究背景及问题\n随着以“核心素养”为导向的新一轮教学改革的快速推进，作为“核心素养之核心”的思维能力得到了越来越多的重视为促进“高阶思维能力发展”这一目标的有效达成，广大中小学教师都在努力寻找有效手段由于具有较高的易用性和较强的实用性，以八大思维图示法（Thinking Maps，也译作思维地图）、思维导图（Mind Maps，也译作心智图或脑图）和概念图（Concept Maps）等为代表的思维可视化工具受到了师生们的广泛欢迎，并逐渐成为推动课堂教学变革、实现深度学习的重要抓手2012 年，赵姝和赵国庆等提出，将“思维训练作为技术促进学习的催化剂”，并将“隐性思维显性化”置于思维训练三阶段的第一个阶段，这与思维可视化工具在教学中得到越来越广泛应用的现状相一致\n尽管思维可视化工具的应用如火如荼，但从教师们在期刊、会议或网络上发表的论文以及分享的教学案例来看，思维可视化工具的应用水平整体还不够高，深入创新应用还比较欠缺', 'page': None, 'doc_metadata': None}, {'position': 3, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '325b8b3e-ee07-4872-b2a4-f5e579d7707c', 'retriever_from': 'workflow', 'score': 0.10983448003190108, 'hit_count': 204, 'word_count': 21, 'segment_position': 121, 'index_node_hash': '77e710b052ce11213efc6185deca50602b3465dba451782ce03876c832d54cbf', 'content': 'question:问题重定义工具对哪种能力的培养有重要作用？ \nanswer:问题重定义工具对于创造性思维的培养具有重要作用。它鼓励人们突破固有的思维模式，从不同角度看待问题，从而提升创新能力与问题解决能力。', 'page': None, 'doc_metadata': None}, {'position': 4, 'dataset_id': '6d35bfbf-bb51-49c3-b648-18d1cdc3ad55', 'dataset_name': '思维工具知识库.xlsx...', 'document_id': '6024b8ee-e947-4e2d-81a1-8ccedc5ac1ee', 'document_name': '思维工具知识库.xlsx', 'data_source_type': 'upload_file', 'segment_id': '8515fc9f-b33e-4803-94c9-f7a638d72718', 'retriever_from': 'workflow', 'score': 0.08474336500103583, 'hit_count': 73, 'word_count': 16, 'segment_position': 64, 'index_node_hash': '1beb2ccbf43f188c51dfd845bffe8147208a7c15b7294b3b675730ccc005796e', 'content': 'question:“可能分析法”的主要用途是什么？ \nanswer:“可能分析法”的主要用途是探索问题的各种可能性，包括潜在的解决方案和未来的发展趋势。它有助于在决策过程中识别和评估各种风险与机会。', 'page': None, 'doc_metadata': None}], 'usage': {'prompt_tokens': 2474, 'prompt_unit_price': '0.0003', 'prompt_price_unit': '0.001', 'prompt_price': '0.0026156', 'completion_tokens': 140, 'completion_unit_price': '0.0006', 'completion_price_unit': '0.001', 'completion_price': '0.0003282', 'total_tokens': 2614, 'total_price': '0.0029438', 'currency': 'RMB', 'latency': 2.6661548018455505}}, 'created_at': 1753828758}
2025-07-30 06:39:21,806 - DifyClient - INFO - [SUCCESS] Dify response: 测试通过！  
你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发展型课堂的具体问题，比如：

- “如何在语文课中融入批判性思维训练？”  
- “八大思维图示法和...
2025-07-30 06:39:21,807 - agent - INFO - Dify response: 测试通过！  
你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发展型课堂的具体问题，比如：

- “如何在语文课中融入批判性思维训练？”  
- “八大思维图示法和...
2025-07-30 06:39:21,808 - debug - INFO - Generated response: 测试通过！  
你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发...
2025-07-30 06:39:21,808 - DingTalkStream - INFO - [SUCCESS] Agent response: 测试通过！  
你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发...
2025-07-30 06:39:21,808 - DingTalkStream - INFO - Sending reply to DingTalk...
2025-07-30 06:39:22,018 - DingTalkStream - INFO - [SUCCESS] Reply sent successfully: 测试通过！  
你已经成功触发了mindmate的思维教学专业响应机制。接下来，你可以提出关于思维发...
2025-07-30 06:39:22,020 - DingTalkStream - INFO - --- MESSAGE HANDLED ---
2025-07-30 06:39:29,845 - websockets.client - DEBUG - < TEXT '{"specVersion":"1.0","type":"CALLBACK","headers...sgtype\\":\\"text\\"}"}' [1068 bytes]
2025-07-30 06:39:29,846 - DingTalkStream - INFO - MessageHandler.raw_process invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=d0242c7a-6ccc-11f0-89fb-2eaa794b294e, content_type=application/json, message_id=2166e316_c38_19830d3f902_18c022d, time=1753828769688, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:39:29,846 - DingTalkStream - INFO - MessageHandler.__call__ invoked with message: CallbackMessage(spec_version=1.0, type=CALLBACK, headers=Headers(app_id=2bd4faa1-16f9-4bd7-a30a-f4df947b3ab3, connection_id=d0242c7a-6ccc-11f0-89fb-2eaa794b294e, content_type=application/json, message_id=2166e316_c38_19830d3f902_18c022d, time=1753828769688, topic=/v1.0/im/bot/messages/get, extensions={}), data={'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}, extensions={})
2025-07-30 06:39:29,847 - DingTalkStream - INFO - --- MESSAGE RECEIVED ---
2025-07-30 06:39:29,848 - DingTalkStream - INFO - Message type: <class 'dingtalk_stream.frames.CallbackMessage'>
2025-07-30 06:39:29,848 - DingTalkStream - DEBUG - Message data: {'senderPlatform': 'iOS', 'conversationId': 'cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=', 'chatbotCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'chatbotUserId': '$:LWCP_v1:$ad6D7YJ2bHnXLD6XQudsY20B6xEPoDVD', 'msgId': 'msgd2DhLcmG91/7nYDtk6KJcQ==', 'senderNick': '王寸尺', 'isAdmin': True, 'senderStaffId': 'manager7439', 'sessionWebhookExpiredTime': 1753834109660, 'createAt': 1753828709447, 'senderCorpId': 'dingd4b29cf70ce8eb01a39a90f97fcb1e09', 'conversationType': '1', 'senderId': '$:LWCP_v1:$BebpsCpQn3ywmyZHrCV5UT41gGmVzB4O', 'sessionWebhook': 'https://oapi.dingtalk.com/robot/sendBySession?session=52a1955c81adca23ba1dbaf321970ece', 'text': {'content': '你好'}, 'robotCode': 'dingr6bg0cj9ylmlpuqz', 'msgtype': 'text'}
2025-07-30 06:39:29,849 - DingTalkStream - INFO - Text: 你好
2025-07-30 06:39:29,849 - DingTalkStream - INFO - User: manager7439
2025-07-30 06:39:29,849 - DingTalkStream - INFO - Conversation: cid6+Wph5U+NW/HIV9Ktt8U07fiFa5YsHT5J8Wt6c4qx+A=
2025-07-30 06:39:29,850 - DingTalkStream - INFO - Message ID: msgd2DhLcmG91/7nYDtk6KJcQ==
2025-07-30 06:39:29,850 - DingTalkStream - INFO - [SUCCESS] Received: 你好...
2025-07-30 06:39:29,850 - DingTalkStream - INFO - Calling AI Agent...
2025-07-30 06:39:29,850 - debug - INFO - Processing message: 你好...
2025-07-30 06:39:29,850 - debug - INFO - Sending to AI Agent...
2025-07-30 06:39:29,851 - agent - INFO - Processing: 你好...
2025-07-30 06:39:29,851 - agent - INFO - User: manager7439
2025-07-30 06:39:29,852 - agent - INFO - Calling Dify API...
2025-07-30 06:39:29,852 - DifyClient - INFO - Sending to Dify API: 你好...
2025-07-30 06:39:29,852 - DifyClient - DEBUG - URL: http://dify.mindspringedu.com/v1/chat-messages
2025-07-30 06:39:29,852 - DifyClient - DEBUG - Payload: {'inputs': {}, 'query': '你好', 'response_mode': 'blocking', 'user': 'manager7439', 'conversation_id': '', 'files': []}
2025-07-30 06:39:37,128 - DifyClient - INFO - Response Status: 200
2025-07-30 06:39:37,129 - DifyClient - DEBUG - Response Data: {'event': 'message', 'task_id': '8672ccb3-c7cd-4e77-b5cd-4625465a613e', 'id': '6b9f983a-e5d1-4eb3-99f1-a4df22b097cf', 'message_id': '6b9f983a-e5d1-4eb3-99f1-a4df22b097cf', 'conversation_id': '6cf170a1-9b47-4095-8f5d-409d15a70821', 'mode': 'advanced-chat', 'answer': '你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。我的功能主要是为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。你可以问我一些和教学相关的问题，比如“如何在《三角形内角和》这节课设计认知冲突？”“学生在《函数》概念上存在哪些迷思概念？”“一元二次方程的应用题可以设计什么样的变式教学？”“在讲解基因的分离定律时可以运用哪些思维工具？”', 'metadata': {'usage': {'prompt_tokens': 1647, 'prompt_unit_price': '0', 'prompt_price_unit': '0', 'prompt_price': '0.002204', 'completion_tokens': 582, 'completion_unit_price': '0', 'completion_price_unit': '0', 'completion_price': '0.000296', 'total_tokens': 2229, 'total_price': '0.0025', 'currency': 'USD', 'latency': 6.790906664915383}}, 'created_at': 1753828770}
2025-07-30 06:39:37,129 - DifyClient - INFO - [SUCCESS] Dify response: 你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。我的功能主要是为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。你可以问我一些和教学相...
2025-07-30 06:39:37,130 - agent - INFO - Dify response: 你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。我的功能主要是为教师提供启发性的教学建议，还有思维教学相关的理论与实践指导哦。你可以问我一些和教学相...
2025-07-30 06:39:37,130 - debug - INFO - Generated response: 你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。...
2025-07-30 06:39:37,131 - DingTalkStream - INFO - [SUCCESS] Agent response: 你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。...
2025-07-30 06:39:37,131 - DingTalkStream - INFO - Sending reply to DingTalk...
2025-07-30 06:39:37,277 - DingTalkStream - INFO - [SUCCESS] Reply sent successfully: 你好！欢迎和我聊天呀。我是MindMate，是你的虚拟教研伙伴，更是“思维发展型课堂”的资深专家呢。...
2025-07-30 06:39:37,278 - DingTalkStream - INFO - --- MESSAGE HANDLED ---
2025-07-30 06:39:38,462 - websockets.client - DEBUG - > PING 'Z\x13^K' [text, 4 bytes]
2025-07-30 06:39:38,464 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:39:39,049 - websockets.client - DEBUG - < PONG 'Z\x13^K' [text, 4 bytes]
2025-07-30 06:39:39,051 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:39:58,451 - websockets.client - DEBUG - > PING 4b 26 ea 6a [binary, 4 bytes]
2025-07-30 06:39:58,467 - websockets.client - DEBUG - > PING 96 ba 45 e0 [binary, 4 bytes]
2025-07-30 06:39:58,469 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:39:58,921 - websockets.client - DEBUG - < PONG 4b 26 ea 6a [binary, 4 bytes]
2025-07-30 06:39:58,942 - websockets.client - DEBUG - < PONG 96 ba 45 e0 [binary, 4 bytes]
2025-07-30 06:39:58,944 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:40:18,482 - websockets.client - DEBUG - > PING b5 57 d3 02 [binary, 4 bytes]
2025-07-30 06:40:18,484 - websockets.client - DEBUG - % sent keepalive ping
2025-07-30 06:40:18,953 - websockets.client - DEBUG - < PONG b5 57 d3 02 [binary, 4 bytes]
2025-07-30 06:40:18,954 - websockets.client - DEBUG - % received keepalive pong
2025-07-30 06:40:31,804 - debug - INFO - Received signal 2, shutting down gracefully...
2025-07-30 06:40:31,884 - websockets.client - DEBUG - > CLOSE 1000 (OK) [2 bytes]
2025-07-30 06:40:31,886 - websockets.client - DEBUG - = connection is CLOSING
2025-07-30 06:40:31,887 - websockets.client - DEBUG - ! error while sending data
Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 51, in get
    await self.get_waiter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 77, in start
    async for raw_message in websocket:
        json_message = json.loads(raw_message)
        asyncio.create_task(self.background_task(json_message))
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 242, in __aiter__
    yield await self.recv()
          ^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 303, in recv
    return await self.recv_messages.get(decode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 159, in get
    frame = await self.frames.get(not self.closed)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 53, in get
    self.get_waiter.cancel()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 697, in _write_appdata
    self._do_write()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 716, in _do_write
    self._process_outgoing()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 722, in _process_outgoing
    self._transport.write(data)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 914, in send_context
    self.send_data()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 969, in send_data
    self.transport.write(data)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 222, in write
    self._ssl_protocol._write_appdata((data,))
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 700, in _write_appdata
    self._fatal_error(ex, 'Fatal error on SSL protocol')
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 918, in _fatal_error
    self._transport._force_close(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 152, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-07-30 06:40:31,904 - DingTalkStream - ERROR - Error starting stream client: no running event loop
2025-07-30 06:40:31,914 - DingTalkStream - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 51, in get
    await self.get_waiter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 77, in start
    async for raw_message in websocket:
        json_message = json.loads(raw_message)
        asyncio.create_task(self.background_task(json_message))
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 242, in __aiter__
    yield await self.recv()
          ^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 303, in recv
    return await self.recv_messages.get(decode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 159, in get
    frame = await self.frames.get(not self.closed)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 53, in get
    self.get_waiter.cancel()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 74, in start
    async with websockets.connect(uri) as websocket:
               ~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\client.py", line 595, in __aexit__
    await self.connection.close()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 635, in close
    async with self.send_context():
               ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 221, in __aexit__
    await anext(self.gen)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 954, in send_context
    self.transport.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 250, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 255, in _force_close
    self._ssl_protocol._abort(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 674, in _abort
    self._transport._force_close(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 152, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 498, in start
    await self.client.start()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 88, in start
    await asyncio.sleep(3)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 712, in sleep
    loop = events.get_running_loop()
RuntimeError: no running event loop

2025-07-30 06:40:31,916 - debug - ERROR - Error in application: no running event loop
2025-07-30 06:40:31,920 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 51, in get
    await self.get_waiter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 77, in start
    async for raw_message in websocket:
        json_message = json.loads(raw_message)
        asyncio.create_task(self.background_task(json_message))
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 242, in __aiter__
    yield await self.recv()
          ^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 303, in recv
    return await self.recv_messages.get(decode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 159, in get
    frame = await self.frames.get(not self.closed)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 53, in get
    self.get_waiter.cancel()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 74, in start
    async with websockets.connect(uri) as websocket:
               ~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\client.py", line 595, in __aexit__
    await self.connection.close()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 635, in close
    async with self.send_context():
               ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 221, in __aexit__
    await anext(self.gen)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 954, in send_context
    self.transport.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 250, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 255, in _force_close
    self._ssl_protocol._abort(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 674, in _abort
    self._transport._force_close(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 152, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 112, in start
    await self.dingtalk_client.start()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 498, in start
    await self.client.start()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 88, in start
    await asyncio.sleep(3)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 712, in sleep
    loop = events.get_running_loop()
RuntimeError: no running event loop

2025-07-30 06:40:31,921 - debug - INFO - Stopping MindBot Stream Application...
2025-07-30 06:40:31,921 - DingTalkStream - INFO - Stopping DingTalk Stream Client...
2025-07-30 06:40:31,921 - DingTalkStream - INFO - DingTalk client connection closed
2025-07-30 06:40:31,921 - DingTalkStream - INFO - DingTalk Stream Client stopped
2025-07-30 06:40:31,921 - debug - INFO - Application stopped successfully
2025-07-30 06:40:31,922 - debug - ERROR - Application error: no running event loop
2025-07-30 06:40:31,925 - debug - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 51, in get
    await self.get_waiter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 77, in start
    async for raw_message in websocket:
        json_message = json.loads(raw_message)
        asyncio.create_task(self.background_task(json_message))
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 242, in __aiter__
    yield await self.recv()
          ^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 303, in recv
    return await self.recv_messages.get(decode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 159, in get
    frame = await self.frames.get(not self.closed)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\messages.py", line 53, in get
    self.get_waiter.cancel()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 74, in start
    async with websockets.connect(uri) as websocket:
               ~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\client.py", line 595, in __aexit__
    await self.connection.close()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 635, in close
    async with self.send_context():
               ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 221, in __aexit__
    await anext(self.gen)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py", line 954, in send_context
    self.transport.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 250, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 255, in _force_close
    self._ssl_protocol._abort(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\sslproto.py", line 674, in _abort
    self._transport._force_close(exc)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 152, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 161, in main
    await app.start()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py", line 112, in start
    await self.dingtalk_client.start()
  File "C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\dingtalk_client.py", line 498, in start
    await self.client.start()
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py", line 88, in start
    await asyncio.sleep(3)
  File "C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 712, in sleep
    loop = events.get_running_loop()
RuntimeError: no running event loop

2025-07-30 06:40:31,926 - debug - INFO - Stopping MindBot Stream Application...
2025-07-30 06:40:31,926 - DingTalkStream - INFO - Stopping DingTalk Stream Client...
2025-07-30 06:40:31,926 - DingTalkStream - INFO - DingTalk client connection closed
2025-07-30 06:40:31,926 - DingTalkStream - INFO - DingTalk Stream Client stopped
2025-07-30 06:40:31,927 - debug - INFO - Application stopped successfully
2025-07-30 06:40:31,927 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task cancelling name='Task-1' coro=<main() done, defined at C:\Users\roywang\Documents\Cursor Projects\mindbot_poc\src\main.py:152> wait_for=<Future cancelled> cb=[gather.<locals>._done_callback() at C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py:820]>
2025-07-30 06:40:31,928 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<Connection.keepalive() done, defined at C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\websockets\asyncio\connection.py:803> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-30 06:40:31,928 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<DingTalkStreamClient.keepalive() done, defined at C:\Users\roywang\AppData\Local\Programs\Python\Python313\Lib\site-packages\dingtalk_stream\stream.py:94> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-07-30 06:41:48,935 - System - INFO - This is an INFO message in bright green
2025-07-30 06:41:48,935 - System - WARNING - This is a WARNING message in bright yellow
2025-07-30 06:41:48,936 - System - ERROR - This is an ERROR message in bright red
2025-07-30 06:41:48,936 - System - DEBUG - This is a DEBUG message in bright blue
2025-07-30 06:41:48,937 - DingTalk - INFO - DingTalk component message
2025-07-30 06:41:48,937 - Dify - INFO - Dify component message
2025-07-30 06:41:48,938 - Agent - INFO - Agent component message
2025-07-30 06:41:48,938 - System - INFO - System component message
2025-07-30 06:41:48,939 - TestComponent - INFO - [92m[1m[SUCCESS][0m This is a SUCCESS message
2025-07-30 06:41:48,940 - TestComponent - ERROR - [91m[1m[FAILURE][0m This is a FAILURE message
2025-07-30 06:41:48,940 - TestComponent - INFO - [92m[1m[SUCCESS][0m This is a step
2025-07-30 06:41:48,941 - TestComponent - WARNING - [93m[1m[WARNING][0m This is a warning step
2025-07-30 06:41:48,941 - TestComponent - ERROR - [91m[1m[ERROR][0m This is an error step
2025-07-30 06:41:48,941 - TestComponent - INFO - [36m[1m━━━ Test Section ━━━[0m
